#include <stdio.h>
#include <stdint.h>
#include <stdbool.h>
#include "../build/usbdev.h"
#include "usbhost.h"

#define JOY3_DN   3
#define JOY2_DN   2
#define JOY1_DN   1
#define KBD_DN   0

#define FAKE_KBD
#define FAKE_JOY1
#define FAKE_JOY2
#define FAKE_JOY3

#ifdef FAKE_KBD
const static uint8_t kbd_rd[] = {0x05,0x01,0x09,0x06,0xA1,0x01,0x05,0x07,0x19,0xE0,0x29,0xE7,0x15,0x00,0x25,0x01,0x75,0x01,0x95,0x08,0x81,0x02,0x95,0x01,0x75,0x08,0x81,0x01,0x95,0x05,0x75,0x01,0x05,0x08,0x19,0x01,0x29,0x05,0x91,0x02,0x95,0x03,0x75,0x01,0x91,0x01,0x95,0x06,0x75,0x08,0x15,0x00,0x26,0xFF,0x00,0x05,0x07,0x19,0x00,0x2A,0xFF,0x00,0x81,0x00,0xC0};
const static uint8_t dd0[18] = {0x12,0x01,0x10,0x01,0x00,0x00,0x00,0x08,0x81,0x0A,0x01,0x01,0x10,0x01,0x01,0x02,0x00,0x01};
const static uint8_t cfg0[] = {0x09,0x02,0x3B,0x00,0x02,0x01,0x00,0xA0,0x32,0x09,0x04,0x00,0x00,0x01,0x03,0x01,0x01,0x00,0x09,0x21,0x10,0x01,0x21,0x01,0x22,0x41,0x00,0x07,0x05,0x81,0x03,0x08,0x00,0x0A,0x09,0x04,0x01,0x00,0x01,0x03,0x00,0x00,0x00,0x09,0x21,0x10,0x01,0x21,0x01,0x22,0x66,0x00,0x07,0x05,0x82,0x03,0x08,0x00,0x0A};
#endif

#ifdef FAKE_JOY1
const static uint8_t joy1_rd[] = {0x05,0x01,0x09,0x04,0xA1,0x01,0xA1,0x02,0x75,0x08,0x95,0x05,0x15,0x00,0x26,0xFF,0x00,0x35,0x00,0x46,0xFF,0x00,0x09,0x30,0x09,0x31,0x09,0x32,0x09,0x32,0x09,0x35,0x81,0x02,0x75,0x04,0x95,0x01,0x25,0x07,0x46,0x3B,0x01,0x65,0x14,0x09,0x39,0x81,0x42,0x65,0x00,0x75,0x01,0x95,0x0C,0x25,0x01,0x45,0x01,0x05,0x09,0x19,0x01,0x29,0x0C,0x81,0x02,0x06,0x00,0xFF,0x75,0x01,0x95,0x08,0x25,0x01,0x45,0x01,0x09,0x01,0x81,0x02,0xC0,0xA1,0x02,0x75,0x08,0x95,0x07,0x46,0xFF,0x00,0x26,0xFF,0x00,0x09,0x02,0x91,0x02,0xC0,0xC0};
const static uint8_t dd1[] = {0x12,0x01,0x00,0x01,0x00,0x00,0x00,0x08,0x79,0x00,0x06,0x00,0x07,0x01,0x01,0x02,0x00,0x01};
const static uint8_t cfg1[] = {0x09,0x02,0x29,0x00,0x01,0x01,0x00,0x80,0xFA,0x09,0x04,0x00,0x00,0x02,0x03,0x00,0x00,0x00,0x09,0x21,0x10,0x01,0x21,0x01,0x22,0x65,0x00,0x07,0x05,0x81,0x03,0x08,0x00,0x0A,0x07,0x05,0x01,0x03,0x08,0x00,0x0A};
#endif


#if 0
#ifdef FAKE_JOY2
const static uint8_t joy2_rd[] = {0x05,0x01,0x09,0x04,0xA1,0x01,0xA1,0x02,0x85,0x01,0x75,0x08,0x95,0x01,0x15,0x00,0x26,0xFF,0x00,0x81,0x03,0x75,0x01,0x95,0x0D,0x15,0x00,0x25,0x01,0x35,0x00,0x45,0x01,0x05,0x09,0x19,0x01,0x29,0x0D,0x81,0x02,0x75,0x01,0x95,0x03,0x06,0x00,0xFF,0x81,0x03,0x05,0x01,0x25,0x07,0x46,0x3B,0x01,0x75,0x04,0x95,0x01,0x65,0x14,0x09,0x39,0x81,0x42,0x65,0x00,0x75,0x01,0x95,0x0C,0x06,0x00,0xFF,0x81,0x03,0x15,0x00,0x26,0xFF,0x00,0x05,0x01,0x09,0x01,0xA1,0x00,0x75,0x08,0x95,0x04,0x15,0x00,0x15,0x00,0x15,0x00,0x35,0x00,0x35,0x00,0x46,0xFF,0x00,0x09,0x30,0x09,0x31,0x09,0x32,0x09,0x35,0x81,0x02,0xC0,0x05,0x01,0x75,0x08,0x95,0x27,0x09,0x01,0x81,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0x91,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0xEE,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0xEF,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xC0};
const static uint8_t dd2[] = {0x12,0x01,0x00,0x02,0x00,0x00,0x00,0x08,0x79,0x00,0x06,0x00,0x00,0x01,0x01,0x02,0x00,0x01};
const static uint8_t cfg2[] = {0x09,0x02,0x29,0x00,0x01,0x01,0x00,0x80,0xFA,0x09,0x04,0x00,0x00,0x02,0x03,0x00,0x00,0x00,0x09,0x21,0x11,0x01,0x00,0x01,0x22,0xB8,0x00,0x07,0x05,0x02,0x03,0x40,0x00,0x01,0x07,0x05,0x81,0x03,0x40,0x00,0x01};
#endif
#endif
#ifdef FAKE_JOY2
const static uint8_t joy2_rd[] = {
0x05,0x01,0x09,0x04,0xA1,0x01,0xA1,0x02,0x85,0x01,0x75,0x08,0x95,0x01,0x15,0x00,
0x26,0xFF,0x00,0x81,0x03,0x75,0x01,0x95,0x0D,0x15,0x00,0x25,0x01,0x35,0x00,0x45,
0x01,0x05,0x09,0x19,0x01,0x29,0x0D,0x81,0x02,0x75,0x01,0x95,0x03,0x06,0x00,0xFF,
0x81,0x03,0x05,0x01,0x25,0x07,0x46,0x3B,0x01,0x75,0x04,0x95,0x01,0x65,0x14,0x09,
0x39,0x81,0x42,0x65,0x00,0x75,0x01,0x95,0x0C,0x06,0x00,0xFF,0x81,0x03,0x15,0x00,
0x26,0xFF,0x00,0x05,0x01,0x09,0x01,0xA1,0x00,0x75,0x08,0x95,0x04,0x15,0x00,0x15,
0x00,0x15,0x00,0x35,0x00,0x35,0x00,0x46,0xFF,0x00,0x09,0x30,0x09,0x31,0x09,0x32,
0x09,0x35,0x81,0x02,0xC0,0x05,0x01,0x75,0x08,0x95,0x27,0x09,0x01,0x81,0x02,0x75,
0x08,0x95,0x30,0x09,0x01,0x91,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,
0xA1,0x02,0x85,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,
0xEE,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0xEF,0x75,0x08,
0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xC0,
};
const static uint8_t dd2[] = {0x12,0x01,0x00,0x02,0x00,0x00,0x00,0x08,0x79,0x00,0x06,0x00,0x00,0x01,0x01,0x02,
0x00,0x01};
const static uint8_t cfg2[] = {0x09,0x02,0x29,0x00,0x01,0x01,0x00,0x80,0xFA,0x09,0x04,0x00,0x00,0x02,0x03,0x00,
0x00,0x00,0x09,0x21,0x11,0x01,0x00,0x01,0x22,0xB8,0x00,0x07,0x05,0x02,0x03,0x40,
0x00,0x01,0x07,0x05,0x81,0x03,0x40,0x00,0x01};
#endif


#ifdef FAKE_JOY3
const static uint8_t joy3_rd[] = {0x05,0x01,0x09,0x04,0xA1,0x01,0xA1,0x02,0x85,0x01,0x75,0x08,0x95,0x01,0x15,0x00,0x26,0xFF,0x00,0x81,0x03,0x75,0x01,0x95,0x13,0x15,0x00,0x25,0x01,0x35,0x00,0x45,0x01,0x05,0x09,0x19,0x01,0x29,0x13,0x81,0x02,0x75,0x01,0x95,0x0D,0x06,0x00,0xFF,0x81,0x03,0x15,0x00,0x26,0xFF,0x00,0x05,0x01,0x09,0x01,0xA1,0x00,0x75,0x08,0x95,0x04,0x35,0x00,0x46,0xFF,0x00,0x09,0x30,0x09,0x31,0x09,0x32,0x09,0x35,0x81,0x02,0xC0,0x05,0x01,0x75,0x08,0x95,0x27,0x09,0x01,0x81,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0x91,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0x02,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0xEE,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xA1,0x02,0x85,0xEF,0x75,0x08,0x95,0x30,0x09,0x01,0xB1,0x02,0xC0,0xC0};
const static uint8_t dd3[] = {0x12,0x01,0x00,0x02,0x00,0x00,0x00,0x40,0x4C,0x05,0x68,0x02,0x00,0x01,0x01,0x02,0x00,0x01};
const static uint8_t cfg3[] = {0x09,0x02,0x29,0x00,0x01,0x01,0x00,0x80,0xFA,0x09,0x04,0x00,0x00,0x02,0x03,0x00,0x00,0x00,0x09,0x21,0x11,0x01,0x00,0x01,0x22,0x94,0x00,0x07,0x05,0x02,0x03,0x40,0x00,0x01,0x07,0x05,0x81,0x03,0x40,0x00,0x01};
#endif

#if 0
const static uint8_t cfg0[] = {0x09,0x02,0x29,0x00,0x01,0x01,0x00,0x80,0xFA,0x09,0x04,0x00,0x00,0x02,0x03,0x00,0x00,0x00,0x09,0x21,0x10,0x01,0x21,0x01,0x22,0x65,0x00,0x07,0x05,0x81,0x03,0x08,0x00,0x0A,0x07,0x05,0x01,0x03,0x08,0x00,0x0A};
const static uint8_t dd0[] = {0x12,0x01,0x00,0x01,0x00,0x00,0x00,0x08,0x79,0x00,0x06,0x00,0x07,0x01,0x01,0x02,0x00,0x01};
#endif

#define lowest(a,b) ((a) < (b) ? (a) : (b))


uint8_t tuh_descriptor_get_device_sync(uint8_t dev_addr, uint8_t *dd, uint16_t len) {
#ifdef FAKE_KBD
  if (dev_addr == KBD_DN) {
    memcpy(dd, dd0, sizeof dd0);
  }
#endif
#ifdef FAKE_JOY1
  if (dev_addr == JOY1_DN) {
    memcpy(dd, dd1, sizeof dd1);
  }
#endif
#ifdef FAKE_JOY2
  if (dev_addr == JOY2_DN) {
    memcpy(dd, dd2, sizeof dd2);
  }
#endif
#ifdef FAKE_JOY3
  if (dev_addr == JOY3_DN) {
    memcpy(dd, dd3, sizeof dd3);
  }
#endif
  return 0;
}

uint8_t tuh_descriptor_get_configuration_sync(uint8_t dev_addr, uint8_t inst, uint8_t *dd, uint16_t len) {
#ifdef FAKE_KBD
  if (dev_addr == KBD_DN) {
    memcpy(dd, cfg0, lowest(sizeof cfg0, len));
  }
#endif
#ifdef FAKE_JOY1
  if (dev_addr == JOY1_DN) {
    memcpy(dd, cfg1, lowest(sizeof cfg1, len));
  }
#endif
#ifdef FAKE_JOY2
  if (dev_addr == JOY2_DN) {
    memcpy(dd, cfg2, lowest(sizeof cfg2, len));
  }
#endif
#ifdef FAKE_JOY3
  if (dev_addr == JOY3_DN) {
    memcpy(dd, cfg3, lowest(sizeof cfg3, len));
  }
#endif
  return 0;
}

#if 0
uint8_t tuh_descriptor_get_string_sync(uint8_t daddr, uint8_t index, uint16_t language_id, void* buffer, uint16_t len) {
  if (dev_addr == 0) {
    memcpy(dd, cfg0, lowest(sizeof cfg0, len));
  }
  return 0;
}

// Sync (blocking) version of tuh_descriptor_get_manufacturer_string()
// return transfer result
uint8_t tuh_descriptor_get_manufacturer_string_sync(uint8_t daddr, uint16_t language_id, void* buffer, uint16_t len);

// Sync (blocking) version of tuh_descriptor_get_product_string()
// return transfer result
uint8_t tuh_descriptor_get_product_string_sync(uint8_t daddr, uint16_t language_id, void* buffer, uint16_t len);

// Sync (blocking) version of tuh_descriptor_get_serial_string()
// return transfer result
uint8_t tuh_descriptor_get_serial_string_sync(uint8_t daddr, uint16_t language_id, void* buffer, uint16_t len);
#endif

#ifdef FAKE_KBD
const static uint8_t kbd_rep1[] = {0x00,0x00,0x0A,0x00,0x00,0x00,0x00,0x00};
const static uint8_t kbd_rep2[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};
const static uint8_t kbd_rep3[] = {0x00,0x00,0x0B,0x00,0x00,0x00,0x00,0x00};
const static uint8_t kbd_rep4[] = {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

void kbd_usbaction(char c) {
#define k KBD_DN
  switch(c) {
    case 'i': // insert
      printf("insert kb\n");
      usb_attached(k, 0, 0x0079, 0x0006, kbd_rd, sizeof kbd_rd, USB_TYPE_HID);
      break;

    case 'r': // remove
      printf("removed kb\n");
      usb_detached(k);
      break;

    case '1': // action1
      printf("act1\n");
      usb_handle_data(k, kbd_rep1, sizeof kbd_rep1);
      break;
    case '2': // action2
      printf("act2\n");
      usb_handle_data(k, kbd_rep2, sizeof kbd_rep2);
      break;
    case '3': // action1
      printf("act3\n");
      usb_handle_data(k, kbd_rep3, sizeof kbd_rep3);
      break;
    case '4': // action2
      printf("act4\n");
      usb_handle_data(k, kbd_rep4, sizeof kbd_rep4);
      break;
  }
#undef k
}
#endif

#ifdef FAKE_JOY1
const static uint8_t joy1_rep1[] = {0x7F,0x7F,0x87,0x7F,0x7F,0x0F,0x00,0xC0};
const static uint8_t joy1_rep2[] = {0x00,0x7F,0x86,0x7F,0x7F,0x0F,0x00,0xC0};
const static uint8_t joy1_rep3[] = {0x7F,0xFF,0x85,0x7F,0x7F,0x0F,0x00,0xC0};
const static uint8_t joy1_rep4[] = {0x7F,0x00,0x87,0x7F,0x7F,0x0F,0x00,0xC0};


void joy1_usbaction(char c) {
#define k JOY1_DN
  switch(c) {
    case 'i': // insert
      printf("insert joy1\n");
      usb_attached(k, 0, 0x0a81, 0x0101, joy1_rd, sizeof joy1_rd, USB_TYPE_HID);
      break;

    case 'r': // remove
      printf("removed joy1\n");
      usb_detached(k);
      break;

    case '1': // action1
      printf("act1\n");
      usb_handle_data(k, joy1_rep1, sizeof joy1_rep1);
      break;
    case '2': // action2
      printf("act2\n");
      usb_handle_data(k, joy1_rep2, sizeof joy1_rep2);
      break;
    case '3': // action1
      printf("act3\n");
      usb_handle_data(k, joy1_rep3, sizeof joy1_rep3);
      break;
    case '4': // action2
      printf("act4\n");
      usb_handle_data(k, joy1_rep4, sizeof joy1_rep4);
      break;
  }
#undef k
}
#endif


#ifdef FAKE_JOY2
const static uint8_t joy2_rep1[] = {0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};
const static uint8_t joy2_rep2[] = {0x01,0x00,0x00,0x00,0x04,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};
const static uint8_t joy2_rep3[] = {0x01,0x00,0x00,0x00,0x06,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};
const static uint8_t joy2_rep4[] = {0x01,0x00,0x00,0x00,0x02,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};


void joy2_usbaction(char c) {
#define k JOY2_DN
  switch(c) {
    case 'i': // insert
      printf("insert joy2\n");
      usb_attached(k, 0, 0x054C, 0x0268, joy2_rd, sizeof joy2_rd, USB_TYPE_HID);
      break;

    case 'r': // remove
      printf("removed joy2\n");
      usb_detached(k);
      break;

    case '1': // action1
      printf("act1\n");
      usb_handle_data(k, joy2_rep1, sizeof joy2_rep1);
      break;
    case '2': // action2
      printf("act2\n");
      usb_handle_data(k, joy2_rep2, sizeof joy2_rep2);
      break;
    case '3': // action1
      printf("act3\n");
      usb_handle_data(k, joy2_rep3, sizeof joy2_rep3);
      break;
    case '4': // action2
      printf("act4\n");
      usb_handle_data(k, joy2_rep4, sizeof joy2_rep4);
      break;
  }
#undef k
}
#endif

#ifdef FAKE_JOY3
const static uint8_t joy3_rep1[] = {0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};
const static uint8_t joy3_rep2[] = {0x01,0x00,0x00,0x00,0x04,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};
const static uint8_t joy3_rep3[] = {0x01,0x00,0x00,0x00,0x06,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};
const static uint8_t joy3_rep4[] = {0x01,0x00,0x00,0x00,0x02,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,0x00};


const static uint8_t joy3_reps[][49] = {
{0x01,0x00,0x00,0x00,0x00,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0xFF,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x01,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0xFF,0xFF,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x02,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0xFF,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x03,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x03,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0xFF,
0xF9,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x03,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0xFF,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x04,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x04,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0xE1,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x04,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x05,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x06,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x05,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0xFF,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x06,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x07,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0xFF,0x00,
0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x00,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0xFF,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x10,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x40,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x08,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x04,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x01,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x02,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x20,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x80,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0xFF,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x10,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x11,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x10,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x12,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x10,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x04,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x08,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,
},{0x01,0x00,0x00,0x00,0x08,0x00,0x7F,0x7F,0x7F,0x7F,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xEF,0x14,
0x00,0x00,0x00,0x00,0x23,0xFF,0x77,0x01,0x81,0x02,0x00,0x02,0x00,0x01,0xA0,0x02,
0x00,}
};


int joy3_idx = 0;

void joy3_usbaction(char c) {
#define k JOY3_DN
  switch(c) {
    case 'i': // insert
      printf("insert joy3\n");
      usb_attached(k, 0, 0x054C, 0x0286, joy3_rd, sizeof joy3_rd, USB_TYPE_HID);
      break;

    case 'r': // remove
      printf("removed joy3\n");
      usb_detached(k);
      break;

    case '1': // action1
      printf("act%d\n", joy3_idx);
      usb_handle_data(k, joy3_reps[joy3_idx], sizeof joy3_reps[joy3_idx]);
      joy3_idx++;
      if (joy3_idx >= (sizeof joy3_reps / sizeof joy3_reps[0])) joy3_idx = 0;
      break;
    case '2': // action2
      printf("act2\n");
      usb_handle_data(k, joy3_rep2, sizeof joy3_rep2);
      break;
    case '3': // action1
      printf("act3\n");
      usb_handle_data(k, joy3_rep3, sizeof joy3_rep3);
      break;
    case '4': // action2
      printf("act4\n");
      usb_handle_data(k, joy3_rep4, sizeof joy3_rep4);
      break;
  }
#undef k
}
#endif

#define XBOX_VID                                0x045E // Microsoft Corporation
#define XBOX_WIRED_PID                          0x028E // Microsoft 360 Wired controller
#define XBOX_DN 4

#include "host/usbh.h"
#include "xinput_host.h"

#define k XBOX_DN
xinputh_interface_t xbox_make_report(uint16_t btn, uint8_t lt, uint8_t rt, int16_t lx, int16_t ly, int16_t rx, int16_t ry) {
  xinputh_interface_t x;

  x.connected = 1;
  x.new_pad_data = 1;
  x.pad.wButtons = btn;
  x.pad.bLeftTrigger = lt;
  x.pad.bRightTrigger = rt;
  x.pad.sThumbLX = lx;
  x.pad.sThumbLY = ly;
  x.pad.sThumbRX = rx;
  x.pad.sThumbRY = ry;
  usb_handle_data(k, &x, sizeof x);
}

int xbox_act = 1;

void xbox_usbaction(char c) {
  switch(c) {
    case 'i': // insert
      printf("insert joy2\n");
      usb_attached(k, 0, XBOX_VID, XBOX_WIRED_PID, joy2_rd, sizeof joy2_rd, USB_TYPE_XBOX);
      break;

    case 'r': // remove
      printf("removed joy2\n");
      usb_detached(k);
      break;

    case '1': // action1
      printf("act1\n");
      switch(xbox_act) {
        case 0: printf("rest \n"); xbox_make_report(0x0000, 0x00, 0x00, 1024, -2304, -2048, 0); break;
        case 1: printf("ll \n"); xbox_make_report(0x0000, 0x00, 0x00, -32768, -2304, -2048, 0); break;
        case 2: printf("lr \n"); xbox_make_report(0x0000, 0x00, 0x00, 32767, -1536, -1792, 0); break;
        case 3: printf("lu \n"); xbox_make_report(0x0000, 0x00, 0x00, 512, 32767, 0, 0); break;
        case 4: printf("ld \n"); xbox_make_report(0x0000, 0x00, 0x00, 512, -32768, -4096, 0); break;
        case 5: printf("rd \n"); xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -1536, -32768); break;
        case 6: printf("ru \n"); xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -1024, 32767); break;
        case 7: printf("rl \n"); xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -32768, 0); break;
        case 8: printf("rr \n"); xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, 32767, 0); break;
        case 9: printf("lt \n"); xbox_make_report(0x0000, 0xff, 0x00, 512, -1536, -768, 0); break;
        case 10: printf("rt \n"); xbox_make_report(0x0000, 0x00, 0xff, 512, -1280, -768, 0); break;
        case 11: printf("a \n"); xbox_make_report(0x1000, 0x00, 0x00, 512, -1280, -768, 0); break;
        case 12: printf("b \n"); xbox_make_report(0x2000, 0x00, 0x00, 512, -1280, -768, 0); break;
        case 13: printf("x \n"); xbox_make_report(0x4000, 0x00, 0x00, 512, -1280, -768, 0); break; // sel
        case 14: printf("y \n"); xbox_make_report(0x8000, 0x00, 0x00, 512, -1280, -768, 0); break; // sta
        case 15: printf("dd \n"); xbox_make_report(0x0002, 0x00, 0x00, 512, -1280, -768, 0); break;
        case 16: printf("dl \n"); xbox_make_report(0x0004, 0x00, 0x00, 512, -1280, -768, 0); break;
        case 17: printf("dr \n"); xbox_make_report(0x0008, 0x00, 0x00, 512, -1280, -768, 0); break;
        case 18: printf("hr \n"); xbox_make_report(0x0080, 0x00, 0x00, 512, -1280, -768, 0); break;
        case 19: printf("back \n"); xbox_make_report(0x0020, 0x00, 0x00, 512, -1280, -768, 0); break; // y
        case 20: printf("start \n"); xbox_make_report(0x0010, 0x00, 0x00, 512, -1280, -768, 0); break; // x
        case 21: printf("lut \n"); xbox_make_report(0x0100, 0x00, 0x00, 512, -1280, -768, 0); break; // l2
        case 22: printf("rut \n"); xbox_make_report(0x0200, 0x00, 0x00, 512, -1280, -768, 0); break; // r2

// [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: ff RT: 00, LX: 512, LY: -1536, RX: -768, RY: 0
// [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: ff, LX: 512, LY: -1280, RX: -768, RY: 0


        // case 0: xbox_make_report(0x0000, 0x00, 0x00, 1024, -2304, -2048, 0); break;
        // case 1: xbox_make_report(0x0000, 0x00, 0x00, -32768, -2304, -2048, 0); break;
        // case 2: xbox_make_report(0x0000, 0x00, 0x00, 32767, -1536, -1792, 0); break;
        // case 3: xbox_make_report(0x0000, 0x00, 0x00, 512, 32767, 0, 0); break;
        // case 4: xbox_make_report(0x0000, 0x00, 0x00, 512, -32768, -4096, 0); break;
        // case 5: xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -1536, -32768); break;
        // case 6: xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -1024, 32767); break;
        // case 7: xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -32768, 0); break;
        // case 8: xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, 32767, 0); break;
        // case 9: xbox_make_report(0x0000, 0x00, 0x00, 512, -1536, -768, 0); break;
        // case 10: xbox_make_report(0x0000, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 11: xbox_make_report(0x1000, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 12: xbox_make_report(0x2000, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 13: xbox_make_report(0x4000, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 14: xbox_make_report(0x8000, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 15: xbox_make_report(0x0002, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 16: xbox_make_report(0x0004, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 17: xbox_make_report(0x0008, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 18: xbox_make_report(0x0080, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 19: xbox_make_report(0x0020, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 20: xbox_make_report(0x0010, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 21: xbox_make_report(0x0100, 0x00, 0x00, 512, -1280, -768, 0); break;
        // case 22: xbox_make_report(0x0200, 0x00, 0x00, 512, -1280, -768, 0); break;
        default: xbox_act = -1;
      }
      xbox_act ++;
      break;
  }
#undef k
}


static int device = 0;

typedef void (*device_fn)(char c);

device_fn fn[] =
{
	kbd_usbaction,
	joy1_usbaction,
	joy2_usbaction,
	joy3_usbaction,
  xbox_usbaction
};


void usbaction(char c) {
	switch(c) {
		case 'a':
		case 'b':
		case 'c':
		case 'd':
		case 'e':
			device = c - 'a';
			printf("device %d selected\n", device);
			break;
		case 'i':
		case 'r':
		case '1':
		case '2':
		case '3':
		case '4':
			fn[device](c);
			break;
	}
}

uint8_t tuh_hid_get_protocol(uint8_t dev_addr, uint8_t instance) {
  return 0;
}

bool tuh_hid_set_protocol(uint8_t dev_addr, uint8_t instance, uint8_t protocol) {
  return 0;
}

bool tuh_hid_set_report(uint8_t dev_addr, uint8_t instance, uint8_t report_id, uint8_t report_type, void* report, uint16_t len) {
  return true;
}

/* 
rest [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 1024, LY: -2304, RX: -2048, RY: 0
ll [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: -32768, LY: -2304, RX: -2048, RY: 0
lr [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 32767, LY: -1536, RX: -1792, RY: 0
lu [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 512, LY: 32767, RX: 0, RY: 0
ld [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 512, LY: -32768, RX: -4096, RY: 0
rd [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 512, LY: -1536, RX: -1536, RY: -32768
ru [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 512, LY: -1536, RX: -1024, RY: 32767
rl [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 512, LY: -1536, RX: -32768, RY: 0
rr [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: 00, LX: 512, LY: -1536, RX: 32767, RY: 0

lt [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: ff RT: 00, LX: 512, LY: -1536, RX: -768, RY: 0
rt [01, 00], Type: Xbox 360 Wired, Buttons 0000, LT: 00 RT: ff, LX: 512, LY: -1280, RX: -768, RY: 0

a [01, 00], Type: Xbox 360 Wired, Buttons 1000, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
b [01, 00], Type: Xbox 360 Wired, Buttons 2000, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
x [01, 00], Type: Xbox 360 Wired, Buttons 4000, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
y [01, 00], Type: Xbox 360 Wired, Buttons 8000, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0

du [01, 00], Type: Xbox 360 Wired, Buttons 0001, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
dd [01, 00], Type: Xbox 360 Wired, Buttons 0002, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
dl [01, 00], Type: Xbox 360 Wired, Buttons 0004, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
dr [01, 00], Type: Xbox 360 Wired, Buttons 0008, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0

hl [01, 00], Type: Xbox 360 Wired, Buttons 0040, LT: 00 RT: 00, LX: 512, LY: -1536, RX: -768, RY: 0
hr [01, 00], Type: Xbox 360 Wired, Buttons 0080, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0

back [01, 00], Type: Xbox 360 Wired, Buttons 0020, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
start [01, 00], Type: Xbox 360 Wired, Buttons 0010, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0

lut [01, 00], Type: Xbox 360 Wired, Buttons 0100, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
rut [01, 00], Type: Xbox 360 Wired, Buttons 0200, LT: 00 RT: 00, LX: 512, LY: -1280, RX: -768, RY: 0
*/